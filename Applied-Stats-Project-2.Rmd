---
title: "Untitled"
output: html_document
date: "2023-07-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

#Reading in the Data
```{r}
data = read_csv('https://raw.githubusercontent.com/willjones11/AppliedStatsProject2/main/adult.data', col_names =  c('age', 'workclass', 'fnlwgt', 'education', 'education-num', 'marital-status', 
                                                                             'occupation', 'relationship', 'race', 'sex'))
head(data)
```
#EDA
```{r}
library(ggplot2)
library(dplyr)
library(GGally)

#breakdown of eductation
temp <- data.frame(data)
temp$education <- factor(temp$education, c('Preschool', '1st-4th', '5th-6th','7th-8th', '9th', '10th', '11th', '12th', 'HS-grad',
                                           'Some-college', 'Assoc-voc', 'Assoc-acdm', 'Bachelors', 'Masters',
                                           'Prof-school', 'Doctorate'))
temp %>% ggplot(aes(x=education)) +
  geom_histogram(stat='count') + 
  scale_x_discrete(guide = guide_axis(angle = 45))

#breakdown of marital status
data %>% ggplot(aes(x=`marital-status`)) +
  geom_histogram(stat='count') + 
  scale_x_discrete(guide = guide_axis(angle = 45)) 

#breakdown of sex
data %>% ggplot(aes(x=sex)) +
  geom_histogram(stat='count')

#breakdown of race
data %>% ggplot(aes(x=race)) +
                  geom_histogram(stat='count')

#Breakdown of occupation status
data %>% ggplot(aes(x=workclass)) + 
  geom_histogram(stat='count') + 
  scale_x_discrete(guide = guide_axis(angle = 45)) 

#breakdown of age
data %>% ggplot(aes(x=age)) + 
  geom_histogram(stat='bin', colour='black', fill='red')

#breakdown of pay
data %>% ggplot(aes(x=fnlwgt)) +
  geom_histogram(stat='bin', colour = 'black', fill='red')

#age vs. pay
data %>% ggplot(aes(x=age, y=fnlwgt)) + geom_point()

#age vs. pay per sex 
data %>%  ggplot(aes(x=age, y=fnlwgt, colour = sex)) + geom_point()

#age vs. pay per race
data %>%  ggplot(aes(x=age, y=fnlwgt, colour = race)) + geom_point()

#breakdown of education per sex
data %>% ggplot(aes(x=education, colour = sex, fill=sex)) +
  geom_histogram(stat='count') + 
  scale_x_discrete(guide = guide_axis(angle = 45))

#Breakdown of occupation status
data %>% ggplot(aes(x=workclass,fill=sex, colour=sex)) + 
  geom_histogram(stat='count') + 
  scale_x_discrete(guide = guide_axis(angle = 45)) 

# breakdown of over/under 50k
data %>% ggplot(aes(x=X15)) + 
  geom_histogram(stat='count')


data$y <- ifelse(data$X15 == '>50K', 1, 0)

print(data)
#Pay by age per sex
ggplot(data, aes(x=age, y=y, colour=sex)) + geom_point() +
  geom_smooth(method="loess", linewidth=1)

#pay by age per marital status
ggplot(data, aes(x=age, y=y, colour=factor(`marital-status`))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(`marital-status`))

#pay by age per race
ggplot(data, aes(x=fnlwgt, y=y, colour=factor(race))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(race))

#pay by age per workclass
ggplot(data, aes(x=age, y=y, colour=factor(workclass))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(workclass))

#pay by age per state
ggplot(data, aes(x=age, y=y, colour=factor(X14))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(X14))

#pay by education per sex
ggplot(data, aes(x=`education-num`, y= y, colour=sex)) + geom_point() +
  geom_smooth(method="loess", linewidth=1)

#pay by education per race
ggplot(data, aes(x=`education-num`, y=y, colour=factor(race))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(race))

#pay by education per workclass
ggplot(data, aes(x=`education-num`, y=y, colour=factor(workclass))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(workclass))

#pay by education per country
ggplot(data, aes(x=age, y=y, colour=factor(X14))) + geom_point() +
  geom_smooth(method="loess", linewidth=1) +
  facet_wrap(~factor(X14))
```
#A train/test split is conducted on the dataset
```{r}

#splitting the data into test/train split
data$make <- factor(ifelse(data$X15 == '>50K', "Yes", "No"))
trainIndex <- createDataPartition(data$X15, p=.7, list=F)
train <- data[trainIndex,]
test <- data[-trainIndex,]
```

# Objective 1
#Now we will get into trying to conduct predictive model since the response variable is binomial we will try to conduct a multiple logistic regression model 
#
```{r}
library(ResourceSelection)
library(caret)
#modeling everything 
full.model <- glm(make~age+`marital-status`+`education-num`+occupation+relationship+sex+race+X11+X12+X13+X14,data = train, family='binomial')

#check for multicolinearity
vif(full.model)

#Assessing the goodness of fit
hoslem.test(train$make, fitted(full.model))

#odds ratio interpretation of variable
exp(cbind("Odds Ratio" = coef(full.model), confint.default(full.model, level = 0.95)))

# Predict the response variable for the test set
prob <- predict(full.model, test, type="response", se.fit=FALSE)
pred <- factor(ifelse(prob > 0.5,"Yes","No"))
#create confusion matrix
confusionMatrix(test$make, pred)

```
#From VIF check 
# looking at the variableds from the generalized square variance inflation factor most of the variables are not suspected of mutlicolinearity but relationship and `marital status` have a high VIF so they should be removed from further models because of the mutlicolinearity
# The Hosmer Lemeshow test yielded a p-value of 2.2e-16 indicating that the current model fits the data well.  
# Some interpretations of the variables based upon the odds ratio
#
#The odds of 
#
#
#
#
#
#
